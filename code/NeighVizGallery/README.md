# NeighVizGallery
An R package for extracting and visualizing the neighborhood of query cells in gallery view
 
### System requirements
- R (>= 3.5.0)
- UNIX, Mac or Windows
- see DESCRIPTION for full dependencies


### Installation
```
git clone https://github.com/Nanostring-Biostats/NeighVizGallery.git
devtools::install()
```


### Demo
See the "vignettes" folder. 
- `tutorial.R` for example usages of functions for individual task.


This code expects the file format output generated by CosMx Single Molecular Imager (SMI) and `napari-cosMx` plugin. Here are the example data/folder structure of the required input files. 

- Example cell metadata:

![](https://github.com/Nanostring-Biostats/CosMx-Analysis-Scratch-Space/assets/62775692/d184cbb2-cf16-4c57-a40d-f08dbbd117fd)
  

- Example `CellStatsDir` and `ProteinDir` under raw data folder of given slide. 

  1. Each FOV subfolder under `CellStatsDir` contains cell label images of given FOV. 
  
![](https://github.com/Nanostring-Biostats/CosMx-Analysis-Scratch-Space/assets/62775692/93abb89c-9183-42c4-867d-3bef776dd5da)
  
  
  2. `Morphology2D` subfolder under `CellStatsDir` contains multi-channel morphology images of each FOV.  
  
![](https://github.com/Nanostring-Biostats/CosMx-Analysis-Scratch-Space/assets/62775692/c3959a43-3cf3-465b-9973-49ea90f2ba1b)
  
  
  3. Each FOV subfolder under `ProteinDir` contains a folder called `ProteinImages`, which has single-channel images for all the protein profiled for the given FOV. 
  
![](https://github.com/Nanostring-Biostats/CosMx-Analysis-Scratch-Space/assets/62775692/4ed24148-9792-4c3b-9f3f-9243237042b4)


- Example `napari-cosmx` dataset with stitched images: `labels` for cell labels, `protein/[proteinName]` for single-channel protein images, other folders (e.g. `DNA`) for single-channel morphology images. 

  ![](https://github.com/Nanostring-Biostats/CosMx-Analysis-Scratch-Space/assets/62775692/9d253fb8-92d5-4169-8598-76e7454cbaac)
  
  


Below are the example outputs of plotting query cells' neighborhood: 

  - Plotting morphology images and cell borers of query cells's neighborhood 
  
![](https://github.com/Nanostring-Biostats/CosMx-Analysis-Scratch-Space/assets/62775692/c3011b26-2bab-4005-bb75-da868199be8c)

  - Plotting numeric and categorical metadata of query cells' neighborhood
  
![](https://github.com/Nanostring-Biostats/CosMx-Analysis-Scratch-Space/assets/62775692/4f43e0be-88f0-4a3b-9036-92e31b61d5aa)
